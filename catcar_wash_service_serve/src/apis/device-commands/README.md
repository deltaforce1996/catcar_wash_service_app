# Device Commands API

API ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡πÑ‡∏õ‡∏¢‡∏±‡∏á‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏ú‡πà‡∏≤‡∏ô MQTT Protocol

## Overview

Device Commands API ‡∏ä‡πà‡∏ß‡∏¢‡πÉ‡∏´‡πâ‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ï‡πà‡∏≤‡∏á‡πÜ ‡πÑ‡∏õ‡∏¢‡∏±‡∏á‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå (Device) ‡∏ó‡∏µ‡πà‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏≠‡∏¢‡∏π‡πà‡πÑ‡∏î‡πâ‡πÅ‡∏ö‡∏ö Real-time ‡∏ú‡πà‡∏≤‡∏ô MQTT Broker ‡πÇ‡∏î‡∏¢‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏£‡∏≠‡∏£‡∏±‡∏ö Acknowledgment (ACK) ‡∏à‡∏≤‡∏Å‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏ß‡πà‡∏≤‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ñ‡∏π‡∏Å‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à

## Supported Commands

| Command | Description | Requires ACK |
|---------|-------------|--------------|
| `APPLY_CONFIG` | ‡∏™‡πà‡∏á configuration ‡πÉ‡∏´‡∏°‡πà‡πÉ‡∏´‡πâ‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå | ‚úÖ Yes |
| `RESTART` | ‡∏™‡∏±‡πà‡∏á‡πÉ‡∏´‡πâ‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå restart | ‚úÖ Yes |
| `UPDATE_FIRMWARE` | ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó firmware version | ‚úÖ Yes |
| `RESET_CONFIG` | ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï configuration ‡∏Å‡∏•‡∏±‡∏ö‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô | ‚úÖ Yes |
| `MANUAL_PAYMENT` | ‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô‡πÅ‡∏ö‡∏ö manual ‡πÉ‡∏´‡πâ‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå | ‚úÖ Yes |
| `CUSTOM` | ‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡πÄ‡∏≠‡∏á | ‚öôÔ∏è Configurable |

## API Endpoints

### 1. Apply Configuration

‡∏™‡πà‡∏á configuration ‡πÉ‡∏´‡∏°‡πà‡πÉ‡∏´‡πâ‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå

**Endpoint:** `POST /api/v1/device-commands/:deviceId/apply-config`

**Authentication:** Required (JWT Token)

**Authorization:** `ADMIN`, `SUPER_ADMIN`

**Request Body:**

```json
{
  "machine": {
    "ACTIVE": true,
    "BANKNOTE": true,
    "COIN": true,
    "QR": true,
    "ON_TIME": "08:00",
    "OFF_TIME": "22:00",
    "SAVE_STATE": true
  },
  "function": {
    "sec_per_baht": {
      "HP_WATER": 5,
      "FOAM": 3,
      "AIR": 4,
      "WATER": 6,
      "VACUUM": 4,
      "BLACK_TIRE": 3,
      "WAX": 2,
      "AIR_FRESHENER": 2,
      "PARKING_FEE": 1
    }
  },
  "pricing": {
    "BASE_FEE": 20,
    "PROMOTION": 0,
    "WORK_PERIOD": 300
  },
  "function_start": {
    "DUST_BLOW": 5,
    "SANITIZE": 0,
    "UV": 0,
    "OZONE": 0,
    "DRY_BLOW": 0,
    "PERFUME": 0
  },
  "function_end": {
    "DUST_BLOW": 0,
    "SANITIZE": 10,
    "UV": 30,
    "OZONE": 60,
    "DRY_BLOW": 20,
    "PERFUME": 5
  }
}
```

**Response:**

```json
{
  "success": true,
  "message": "Command sent to device D001",
  "data": {
    "command_id": "cmd-1697654321000-abc123",
    "device_id": "D001",
    "command": "APPLY_CONFIG",
    "status": "SUCCESS",
    "timestamp": 1697654325000,
    "results": {
      "config_applied": { ... },
      "timestamp": 1697654325000
    }
  }
}
```

---

### 2. Restart Device

‡∏™‡∏±‡πà‡∏á‡πÉ‡∏´‡πâ‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå restart

**Endpoint:** `POST /api/v1/device-commands/:deviceId/restart`

**Authentication:** Required (JWT Token)

**Authorization:** `ADMIN`, `SUPER_ADMIN`

**Request Body:**

```json
{
  "delay_seconds": 5
}
```

**Response:**

```json
{
  "success": true,
  "message": "Restart command sent to device D001",
  "data": {
    "command_id": "cmd-1697654321000-def456",
    "device_id": "D001",
    "command": "RESTART",
    "status": "SUCCESS",
    "timestamp": 1697654325000,
    "results": {
      "delay_seconds": 5,
      "restart_at": 1697654330000
    }
  }
}
```

---

### 3. Update Firmware

‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó firmware version ‡∏Ç‡∏≠‡∏á‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå

**Endpoint:** `POST /api/v1/device-commands/:deviceId/update-firmware`

**Authentication:** Required (JWT Token)

**Authorization:** `ADMIN`, `SUPER_ADMIN`

**Request Body:**

```json
{
  "url": "https://example.com/firmware/v2.0.0.bin",
  "version": "2.0.0",
  "sha256": "abc123def456...",
  "size": 2048576,
  "reboot_after": true
}
```

**Response:**

```json
{
  "success": true,
  "message": "Firmware update command sent to device D001",
  "data": {
    "command_id": "cmd-1697654321000-ghi789",
    "device_id": "D001",
    "command": "UPDATE_FIRMWARE",
    "status": "SUCCESS",
    "timestamp": 1697654325000,
    "results": {
      "version": "2.0.0",
      "download_started": true,
      "estimated_time": 300
    }
  }
}
```

---

### 4. Reset Configuration

‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï configuration ‡∏Å‡∏•‡∏±‡∏ö‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡πà‡∏≤‡∏ó‡∏µ‡πà‡∏£‡∏∞‡∏ö‡∏∏

**Endpoint:** `POST /api/v1/device-commands/:deviceId/reset-config`

**Authentication:** Required (JWT Token)

**Authorization:** `ADMIN`, `SUPER_ADMIN`

**Request Body:** ‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡∏Å‡∏±‡∏ö Apply Configuration

**Response:**

```json
{
  "success": true,
  "message": "Config reset command sent to device D001",
  "data": {
    "command_id": "cmd-1697654321000-jkl012",
    "device_id": "D001",
    "command": "RESET_CONFIG",
    "status": "SUCCESS",
    "timestamp": 1697654325000
  }
}
```

---

### 5. Send Manual Payment

‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô‡πÅ‡∏ö‡∏ö manual ‡πÉ‡∏´‡πâ‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå

**Endpoint:** `POST /api/v1/device-commands/:deviceId/manual-payment`

**Authentication:** Required (JWT Token)

**Authorization:** `ADMIN`, `SUPER_ADMIN`

**Request Body:**

```json
{
  "amount": 50
}
```

**Response:**

```json
{
  "success": true,
  "message": "Manual payment sent to device D001",
  "data": {
    "command_id": "cmd-1697654321000-xyz789",
    "device_id": "D001",
    "command": "MANUAL_PAYMENT",
    "status": "SUCCESS",
    "timestamp": 1697654325000,
    "results": {
      "amount": 50,
      "expire_at": 1697654335000
    }
  }
}
```

---

### 6. Send Custom Command

‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡πÄ‡∏≠‡∏á

**Endpoint:** `POST /api/v1/device-commands/:deviceId/custom`

**Authentication:** Required (JWT Token)

**Authorization:** `ADMIN`, `SUPER_ADMIN`

**Request Body:**

```json
{
  "command": "MY_CUSTOM_COMMAND",
  "payload": {
    "param1": "value1",
    "param2": 123
  },
  "require_ack": true
}
```

**Response:**

```json
{
  "success": true,
  "message": "Custom command sent to device D001",
  "data": {
    "command_id": "cmd-1697654321000-mno345",
    "device_id": "D001",
    "command": "MY_CUSTOM_COMMAND",
    "status": "SUCCESS",
    "timestamp": 1697654325000
  }
}
```

## Command Status

| Status | Description |
|--------|-------------|
| `SENT` | ‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ñ‡∏π‡∏Å‡∏™‡πà‡∏á‡πÑ‡∏õ‡∏¢‡∏±‡∏á‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡πÅ‡∏•‡πâ‡∏ß (‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö ACK) |
| `SUCCESS` | ‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à |
| `FAILED` | ‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à |
| `TIMEOUT` | ‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡πÑ‡∏°‡πà‡∏ï‡∏≠‡∏ö‡∏Å‡∏•‡∏±‡∏ö‡∏†‡∏≤‡∏¢‡πÉ‡∏ô‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏´‡∏ô‡∏î (30 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ) |
| `ERROR` | ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á |
| `PROGRESS` | ‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£ |

## MQTT Topics

### Command Topic (Server ‚Üí Device)

```
device/{deviceId}/command
```

**Payload Format:**

```json
{
  "command_id": "cmd-1697654321000-abc123",
  "command": "APPLY_CONFIG",
  "require_ack": true,
  "payload": { ... },
  "timestamp": 1697654321000
}
```

### ACK Topic (Device ‚Üí Server)

```
server/{deviceId}/ack
```

**Payload Format:**

```json
{
  "command_id": "cmd-1697654321000-abc123",
  "device_id": "D001",
  "command": "APPLY_CONFIG",
  "status": "SUCCESS",
  "result": { ... },
  "error": null,
  "timestamp": 1697654325000
}
```

## Testing with Simulator

### ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô Device Command Simulator

1. **‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á dependencies:**

```bash
cd catcar_api_client
pip install -r requirements.txt
```

2. **‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô simulator:**

```bash
python device_command_simulator.py
```

3. **‡∏Å‡∏£‡∏≠‡∏Å Device ID:**

```
üÜî Enter Device ID (e.g., D001): D001
```

4. **Simulator ‡∏à‡∏∞‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ü‡∏±‡∏á‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏à‡∏≤‡∏Å MQTT Broker**

### ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á

1. **‡πÄ‡∏£‡∏¥‡πà‡∏° simulator ‡πÉ‡∏ô‡∏´‡∏ô‡∏∂‡πà‡∏á terminal:**

```bash
python device_command_simulator.py
# Enter Device ID: D001
```

2. **‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ú‡πà‡∏≤‡∏ô API ‡πÉ‡∏ô‡∏≠‡∏µ‡∏Å terminal:**

```bash
# Get JWT token first
curl -X POST http://localhost:3000/api/v1/auth/login \
  -H "Content-Type: application/json" \
  -d '{
    "email": "admin@example.com",
    "password": "password123"
  }'

# Send apply config command
curl -X POST http://localhost:3000/api/v1/device-commands/D001/apply-config \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer YOUR_JWT_TOKEN" \
  -d '{
    "machine": {
      "ACTIVE": true,
      "BANKNOTE": true,
      "COIN": true,
      "QR": true,
      "ON_TIME": "08:00",
      "OFF_TIME": "22:00",
      "SAVE_STATE": true
    }
  }'
```

3. **‡∏î‡∏π‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡πÉ‡∏ô simulator:**

```
[12:34:56] üì• Received message on device/D001/command
   Payload: {
     "command_id": "cmd-1697654321000-abc123",
     "command": "APPLY_CONFIG",
     ...
   }
üîß Handling APPLY_CONFIG command...
‚úÖ Configuration applied successfully
[12:34:57] üì§ ‚úÖ ACK sent: cmd-1697654321000-abc123 - SUCCESS
```

## Error Handling

### Device Not Found

```json
{
  "success": false,
  "message": "Device D999 not found",
  "statusCode": 404
}
```

### Unauthorized

```json
{
  "success": false,
  "message": "Unauthorized",
  "statusCode": 401
}
```

### Forbidden (Insufficient Permissions)

```json
{
  "success": false,
  "message": "Forbidden resource",
  "statusCode": 403
}
```

### Command Timeout

```json
{
  "success": true,
  "message": "Command sent to device D001",
  "data": {
    "command_id": "cmd-1697654321000-abc123",
    "device_id": "D001",
    "command": "APPLY_CONFIG",
    "status": "TIMEOUT",
    "error": "Device did not respond within timeout period",
    "timestamp": 1697654351000
  }
}
```

## Architecture

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê      HTTP/REST      ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                 ‚îÇ ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ>  ‚îÇ                      ‚îÇ
‚îÇ   Frontend /    ‚îÇ                     ‚îÇ   Device Commands    ‚îÇ
‚îÇ   External API  ‚îÇ                     ‚îÇ      Controller      ‚îÇ
‚îÇ                 ‚îÇ <‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ  ‚îÇ                      ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò      Response       ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                                                    ‚îÇ
                                                    ‚îÇ Call Service
                                                    ‚ñº
                                        ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                                        ‚îÇ   Device Commands    ‚îÇ
                                        ‚îÇ       Service        ‚îÇ
                                        ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                                                    ‚îÇ
                                                    ‚îÇ Use MQTT Manager
                                                    ‚ñº
                                        ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                                        ‚îÇ MQTT Command Manager ‚îÇ
                                        ‚îÇ      Service         ‚îÇ
                                        ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                                                    ‚îÇ
                                                    ‚îÇ Publish Command
                                                    ‚ñº
                                        ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                                        ‚îÇ    MQTT Broker       ‚îÇ
                                        ‚îÇ      (EMQX)          ‚îÇ
                                        ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                                                    ‚îÇ
                                   Subscribe        ‚îÇ         Publish ACK
                                   Command          ‚îÇ
                                  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                                  ‚îÇ                                   ‚îÇ
                                  ‚ñº                                   ‚ñº
                        ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê                ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                        ‚îÇ  Physical Device ‚îÇ                ‚îÇ  Device Simulator‚îÇ
                        ‚îÇ      (IoT)       ‚îÇ                ‚îÇ     (Testing)    ‚îÇ
                        ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò                ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

## Related Services

- **MqttCommandManagerService** - ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á MQTT ‡πÅ‡∏•‡∏∞‡∏£‡∏≠‡∏£‡∏±‡∏ö ACK
- **MqttService** - Low-level MQTT client service
- **DevicesService** - ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡πÉ‡∏ô‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•

## Notes

- ‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏à‡∏∞‡∏°‡∏µ timeout 30 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ
- ‡∏´‡∏≤‡∏Å‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡πÑ‡∏°‡πà‡∏ï‡∏≠‡∏ö‡∏Å‡∏•‡∏±‡∏ö‡∏†‡∏≤‡∏¢‡πÉ‡∏ô timeout ‡∏à‡∏∞‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö status `TIMEOUT`
- ‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á `PAYMENT` ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£ ACK (fire-and-forget) - ‡πÉ‡∏ä‡πâ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÅ‡∏à‡πâ‡∏á payment status
- ‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á `MANUAL_PAYMENT` ‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£ ACK - ‡πÉ‡∏ä‡πâ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô‡πÅ‡∏ö‡∏ö manual
- ‡∏Ñ‡∏ß‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏≠‡∏¢‡∏π‡πà‡∏Å‡πà‡∏≠‡∏ô‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á

